<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	

	<script>
		// Check local storage
		let localS = localStorage.getItem('theme'),
			themeToSet = localS

		// If local storage is not set, we check the OS preference
		if (!localS) {
			themeToSet = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
		}

		// Set the correct theme
		document.documentElement.setAttribute('data-theme', themeToSet)
	</script>
	<!--<script>
	function reloadPage() {
		location.reload();
	}
	
	setInterval(reloadPage, 3000);
	</script>-->
	<!-- Reset -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/modern-normalize@1.1.0/modern-normalize.min.css">

	<!-- Google fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;700&display=swap" rel="stylesheet">

	<!-- Main stylesheet -->
	<!--<link rel="stylesheet" href="app.css">-->
  <title>App Configuration</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="styles1.css">
  <link rel="stylesheet" href="transchk.css">
</head>
<body class="backgroundimg">
<svg style="display: none">
		<symbol id="icon-collapse" viewBox="0 0 20 20">
			<path d="M14.1667 9.16668H4.50835L6.42502 7.25834C6.50271 7.18064 6.56435 7.0884 6.6064 6.98688C6.64845 6.88537 6.67009 6.77656 6.67009 6.66668C6.67009 6.55679 6.64845 6.44799 6.6064 6.34647C6.56435 6.24495 6.50271 6.15271 6.42502 6.07501C6.34732 5.99731 6.25507 5.93568 6.15356 5.89363C6.05204 5.85158 5.94323 5.82993 5.83335 5.82993C5.72347 5.82993 5.61466 5.85158 5.51314 5.89363C5.41162 5.93568 5.31938 5.99731 5.24168 6.07501L1.90835 9.40834C1.83248 9.4876 1.77301 9.58105 1.73335 9.68334C1.65 9.88623 1.65 10.1138 1.73335 10.3167C1.77301 10.419 1.83248 10.5124 1.90835 10.5917L5.24168 13.925C5.31915 14.0031 5.41132 14.0651 5.51287 14.1074C5.61442 14.1497 5.72334 14.1715 5.83335 14.1715C5.94336 14.1715 6.05228 14.1497 6.15383 14.1074C6.25538 14.0651 6.34755 14.0031 6.42502 13.925C6.50312 13.8475 6.56512 13.7554 6.60742 13.6538C6.64973 13.5523 6.67151 13.4434 6.67151 13.3333C6.67151 13.2233 6.64973 13.1144 6.60742 13.0129C6.56512 12.9113 6.50312 12.8191 6.42502 12.7417L4.50835 10.8333H14.1667C14.3877 10.8333 14.5997 10.7455 14.7559 10.5893C14.9122 10.433 15 10.221 15 10C15 9.779 14.9122 9.56703 14.7559 9.41075C14.5997 9.25447 14.3877 9.16668 14.1667 9.16668ZM17.5 3.33334C17.279 3.33334 17.067 3.42114 16.9108 3.57742C16.7545 3.7337 16.6667 3.94566 16.6667 4.16668V15.8333C16.6667 16.0544 16.7545 16.2663 16.9108 16.4226C17.067 16.5789 17.279 16.6667 17.5 16.6667C17.721 16.6667 17.933 16.5789 18.0893 16.4226C18.2456 16.2663 18.3333 16.0544 18.3333 15.8333V4.16668C18.3333 3.94566 18.2456 3.7337 18.0893 3.57742C17.933 3.42114 17.721 3.33334 17.5 3.33334V3.33334Z"/>
		</symbol>
</svg>
	<header id="main-header">
		<nav>
			<button id="main-header__sidebar-toggle">
				<svg id="toggle-icon-menu">
					<use xlink:href="#icon-menu"></use>
				</svg>
				<svg id="toggle-icon-close">
					<use xlink:href="#icon-close"></use>
				</svg>
			</button>

			<ul>
				<li id="main-header__logo">
					<img src="picture/BlueYonder-logo.png" alt="BlueYonder Logo">
				</li>
			</ul>
			<!--<div class="heading">
                    <p>TMS APP CONFIGURATION</p>
            </div>-->
			<div class="heading-container">
    
    <div class="text-container">
        <h3 class="heading-text">App Configurations</h3>
		</div>
	</div>
		</nav>
	</header> <!-- main-header -->
	
<section id="main">
		<div id="overlay"></div>
		
		<div id="sidebar">
			<button id="sidebar__collapse">
				<svg>
					<use xlink:href="#icon-collapse"></use>
				</svg>
				<span>Collapse menu</span>
			</button>

			<nav id="sidebar__nav">
				<ul>
					<li>
						<a href="home.html">
							<span>Home</span>
						</a>
					</li>
					<li>
						<a href="onboard.html">
							<span>Admin</span>
						</a>
					</li>
					<li>
						<a href="restartpage.html">
							<span>Restart Component</span>
						</a>
					</li>
					<li>
						<a href="transchk.html" class="active">
							<span>Transition Check</span>
						</a>
					</li>
				</ul>
			</nav>
		</div> <!-- sidebar -->

		<div id="main-content">
			<div id="main-content__container">
			<div>
					<img class="background" src="picture/blue_2.png" width="100%" height="100%">
			</div>	
		</div>
		</div>
		<div class="d-flex justify-content-center align-items-center">
			<div class="card text-center" style="width:75%">
        
			<div class="container-fluid">
  
  
  <div class="frame33">
    <div class="row">
        <div class="col-6">
            <br>
            <div id="server-input-container-wrapper" style="width: 500px">
                <div class="input-container">
                    <input class="server" type="text" required=""/>
                    <label>SERVER</label>
                    <button class="btn btn-primary add-row" type="button">
                      <span class="bx bx-plus"></span></button>
                </div>
            </div>
            <br>
            <div class="input-container" style="width: 500px">
                <input id="customerInput" type="text" required=""/>
                <label>CUSTOMER</label>
            </div><br>
            <div id="services-input-container-wrapper" style="width: 500px">
                <div class="input-container">
                    <input class="services" type="text" required=""/>
                    <label>SERVICES</label>
                    <button class="btn btn-primary add-row" type="button">
                      <span class="bx bx-plus"></span></button>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="accordion" id="accordionExample">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                            Fileage Monitor
                        </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <form>
                                <div class="input-container">
                                    <input id="fileageServerName" type="text" required=""/>
                                    <label>SERVER NAME</label>
                                </div>
                                <div class="input-container">
                                    <input id="fileageUsername" type="text" required=""/>
                                    <label>USERNAME</label>
                                </div>
                                <div class="input-container">
                                    <input id="fileagePassword" type="password" required=""/>
                                    <label>PASSWORD</label>
                                </div>
                                <div class="input-container">
                                    <input id="fileageDatabaseName" type="text" required=""/>
                                    <label>DATABASE NAME</label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>&nbsp
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                            DB Monitor
                        </button>
                    </h2>
                    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                            <form>
                                <div class="input-container">
                                    <input id="dbServerName" type="text" required=""/>
                                    <label>SERVER NAME</label>
                                </div>
                                <div class="input-container">
                                    <input id="dbUsername" type="text" required=""/>
                                    <label>USERNAME</label>
                                </div>
                                <div class="input-container">
                                    <input id="dbPassword" type="password" required=""/>
                                    <label>PASSWORD</label>
                                </div>
                                <div class="input-container">
                                    <input id="dbDatabaseName" type="text" required=""/>
                                    <label>DATABASE NAME</label>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
		      <center><button type="submit" class="btn btn-sm btn-outline-light" id="submitButton">Submit</button></center>
      </div>

  </div>
  
</div>
		
			</div>
		</div> <!-- main-content -->
	</section>
	 <div class="loading-screen">
		<div class="loading">
			<span></span>
			<span></span>
			<span></span>
			<span></span>
		</div>
	</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
let servers = [];
let services = [];

$(document).ready(function() {
    // Handle adding new rows
    $("body").on("click", ".add-row", function() {
        var inputType = $(this).siblings('input').hasClass('server') ? 'SERVER' : 'SERVICES';
        var newRow = 
            '<div class="input-container">' +
            '<input class="' + inputType.toLowerCase() + '" type="text" required=""/>' +
            '<label>' + inputType + '</label>' +
            '<button class="btn btn-danger delete-row" type="button">' +
            '<i class="bx bxs-trash"></i></button>' +
            '<button class="btn btn-primary add-row" type="button">' +
            '<span class="bx bx-plus"></span></button>' +
            '</div>';
        if (inputType === 'SERVER') {
            $("#server-input-container-wrapper").append(newRow);
        } else {
            $("#services-input-container-wrapper").append(newRow);
        }

        updateArrays(); // Update the arrays after adding a new row
    });

    // Handle deleting rows
    $("body").on("click", ".delete-row", function () {
        $(this).closest(".input-container").remove();
        updateArrays(); // Update the arrays after deleting a row
    });
    
    // Update arrays when input values change
    $("body").on("input", ".server, .services", function() {
        updateArrays(); // Update the arrays after any input change
    });

    // Initialize arrays with current values on page load
    updateArrays();

    // Function to update arrays with current input values
    function updateArrays() {
        // Capture the values of all inputs with class 'server'
        servers = $(".server").map(function() {
            return $(this).val().trim(); // Trim whitespace
        }).get();

        // Capture the values of all inputs with class 'services'
        services = $(".services").map(function() {
            return $(this).val().trim(); // Trim whitespace
        }).get();
        
        // Filter out any empty values
        servers = servers.filter(value => value !== "");
        services = services.filter(value => value !== "");
        
        // Log the current state
        console.log("Servers:", servers);
        console.log("Services:", services);
        console.log("Current State - Servers: ", servers.join(", "), " | Services: ", services.join(", "));
    }
});

// Ensure executePowerShellScript correctly handles arrays
async function executePowerShellScript() {
    const serverInputs = $(".server").map(function() { return $(this).val().trim(); }).get();
    const servicesInputs = $(".services").map(function() { return $(this).val().trim(); }).get();
    const customerInput = document.getElementById('customerInput').value.trim();
    const fileageServerName = document.getElementById('fileageServerName').value.trim();
    const fileageUsername = document.getElementById('fileageUsername').value.trim();
    const fileagePassword = document.getElementById('fileagePassword').value.trim();
    const fileageDatabaseName = document.getElementById('fileageDatabaseName').value.trim();
    const dbServerName = document.getElementById('dbServerName').value.trim();
    const dbUsername = document.getElementById('dbUsername').value.trim();
    const dbPassword = document.getElementById('dbPassword').value.trim();
    const dbDatabaseName = document.getElementById('dbDatabaseName').value.trim();

    try {
        const response = await fetch('http://localhost:8060/executePowerShell', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                serverInput: serverInputs,
                customerInput: customerInput,
                servicesInput: servicesInputs,
                fileageServerName: fileageServerName,
                fileageUsername: fileageUsername,
                fileagePassword: fileagePassword,
                fileageDatabaseName: fileageDatabaseName,
                dbServerName: dbServerName,
                dbUsername: dbUsername,
                dbPassword: dbPassword,
                dbDatabaseName: dbDatabaseName
            })
        });

        if (response.ok) {
            const result = await response.json();

            // Store the inputs in localStorage
            localStorage.setItem("servers", JSON.stringify(serverInputs));
            localStorage.setItem("result", JSON.stringify(result));
            localStorage.setItem("customer", customerInput);
			console.log(result);

            // Redirect to the next page
            window.location.href = "transresult.html";
        } else {
            const errorText = await response.text();
            console.error('Error:', errorText);
            alert('Error occurred: ' + errorText);
        }
    } catch (error) {
        console.error('Fetch error:', error);
        alert('Fetch error: ' + error.message);
    }
}

document.getElementById("submitButton").addEventListener("click", executePowerShellScript);




// Sidebar toggle function
const sidebarToggle = () => {
	document.body.classList.toggle('sidebar-open')
}

// Sidebar trigger
const sidebarTrigger = document.getElementById('main-header__sidebar-toggle')

// Add the event listener for the sidebar toggle
sidebarTrigger.addEventListener('click', sidebarToggle)



// Sidebar collapse function
const sidebarCollapse = () => {
	document.body.classList.toggle('sidebar-collapsed')
}

// Sidebar trigger
const sidebarCollapseTrigger = document.getElementById('sidebar__collapse')

// Add the event listener for the sidebar toggle
sidebarCollapseTrigger.addEventListener('click', sidebarCollapse)



// Theme switcher function
const switchTheme = () => {
	// Get root element and data-theme value
	const rootElem = document.documentElement
	let dataTheme = rootElem.getAttribute('data-theme'),
		newTheme

	newTheme = (dataTheme === 'light') ? 'dark' : 'light'

	// Set the new HTML attribute
	rootElem.setAttribute('data-theme', newTheme)

	// Set the new local storage item
	localStorage.setItem("theme", newTheme)
}

// Add the event listener for the theme switcher
//document.querySelector('#sidebar__theme-switcher').addEventListener('click', switchTheme)

//Reload page 
/*function reloadPage() {
  location.reload();
}

setInterval(reloadPage, 3000); 3000 milliseconds = 3 seconds*/

//set sidebar size automatically based on pagesize
window.addEventListener('resize', function() {
  const sidebar = document.getElementById('sidebar');
  const pageHeight = document.documentElement.clientHeight;
  sidebar.style.paddingBottom = `${pageHeight - sidebar.offsetTop}px`;
});
</script>	
</body>
</html>
