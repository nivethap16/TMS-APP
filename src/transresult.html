<!DOCTYPE html>
<html lang="en">
<head>
<title>TMS App Configuration Report</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<link rel="stylesheet" href="transresult.css">
</head>
<body class="backgroundimg">
<nav class="navbar navbar-expand-sm">
<div class="container-fluid">
</div>
</nav>
<div class="container-fluid">
<a href="transchk.html"><i class='bx bxs-left-arrow-circle bx-md'></i></a>
<div id="dynamicContent" class="mt-3">
<!-- This is where the dynamic content will be inserted -->
            <h4>Customer: </h4><h4>Server: </h4><p>Error: Cannot validate argument on parameter 'ComputerName'. The argument is null or empty. Provide an argument that is not null or empty, and then try the command again.</p><p>Error: Failed to execute the Query: Exception calling "Open" with "0" argument(s): "A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)"</p><p>Error: Failed to execute the Query: Exception calling "Open" with "0" argument(s): "A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server)"</p>
</div>
<div class="frame22 mt-3">
<button class="btn btn-outline-dark" onclick="generateCSV()">Download</button>
</div>
</div>
 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.8.0/html-docx.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
         function generateCSV() {
            // Get the inner HTML of the dynamicContent
            const dynamicContent = document.getElementById('dynamicContent').innerHTML;

            // Function to extract text from HTML content including tables, pre, and p elements
            function extractContentAsCSV(html) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                let csvContent = '';

                // Process each table
                const tables = doc.querySelectorAll('table');
                tables.forEach(table => {
                    const rows = table.querySelectorAll('tr');
                    rows.forEach(row => {
                        const cells = row.querySelectorAll('th, td');
                        const rowData = Array.from(cells).map(cell => `"${cell.textContent.trim()}"`).join(',');
                        csvContent += rowData + '\n';
                    });
                    csvContent += '\n';  // Add an extra newline between tables
                });

                // Process each pre element (for preformatted text like logs)
                const preElements = doc.querySelectorAll('pre');
                preElements.forEach(pre => {
                    const preText = pre.textContent.split('\n').map(line => `"${line.trim()}"`).join('\n');
                    csvContent += preText + '\n\n';  // Add an extra newline after each pre block
                });

                // Process each p element (for paragraph text like errors)
                const paragraphs = doc.querySelectorAll('p');
                paragraphs.forEach(p => {
                    const pText = `"${p.textContent.trim()}"`;
                    csvContent += pText + '\n\n';  // Add an extra newline after each paragraph
                });

                return csvContent;
            }

            const csvData = extractContentAsCSV(dynamicContent);

            // Convert CSV data to a Blob
            const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });

            // Create a link element and trigger the download
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'TMS_App_Report_with_HTML.csv');
            document.body.appendChild(link);  // Required for Firefox
            link.click();  // Trigger the download
            document.body.removeChild(link);  // Clean up
        }
</script>
</body>
</html>
